<style type="text/css">
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] * {outline:none;}
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"]{height:auto;visibility:visible;position:relative;display:block;width:100%;outline:none;font-family:inherit;box-sizing:border-box;overflow:hidden;}
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .retailrocket-items{width:100%;position:relative;background-color:transparent;}
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .retailrocket-item{margin:0 auto;max-width:100%;position:relative;}
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .rr-item__img-block{padding-bottom:0;display:flex;justify-content:center;position:relative;}
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .rr-item__img-block .rr-item__info{width:100%;display:block;position:relative;}
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .rr-item__img-block .rr-item__info img{transition: all .4s ease-in-out 0s;}
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .rr-item__image{width:100%;outline:none;background-repeat:no-repeat;background-position:center center;background-size:cover;}
    
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .rr-swiper-wrapper{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);position:relative;width:100%;height:100%;z-index:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-transition-property:-webkit-transform;transition-property:-webkit-transform;-o-transition-property:transform;transition-property:transform;transition-property:transform,-webkit-transform;-webkit-box-sizing:content-box;box-sizing:content-box;}
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .rr-swiper-slide{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:100%;height:auto;position:relative;-webkit-transition-property:-webkit-transform;transition-property:-webkit-transform;-o-transition-property:transform;transition-property:transform;transition-property:transform,-webkit-transform;}
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .rr-arrow{position:absolute;top:50%;-webkit-transform:translate(0, -50%);-moz-transform:translate(0, -50%);-ms-transform:translate(0, -50%);-o-transform:translate(0, -50%);transform:translate(0, -50%);background:url('https://rrstatic.retailrocket.net/widget/img/slider_arrow.svg') no-repeat center center;background-size:contain;width:30px;height:30px;display:block;-webkit-transition:all ease .3s;-moz-transition:all ease .3s;-ms-transition:all ease .3s;-o-transition:all ease .3s;transition:all ease .3s;cursor:pointer;z-index:1;}
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .swiper-prev{left:0;-webkit-transform:translate(0, -50%) rotate(180deg);-moz-transform:translate(0, -50%) rotate(180deg);-ms-transform:translate(0, -50%) rotate(180deg);-o-transform:translate(0, -50%) rotate(180deg);transform:translate(0, -50%) rotate(180deg);}
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .swiper-prev:hover,
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .swiper-next:hover{opacity:0.5;}
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .swiper-next{right:0;}
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .rr-slider-arrow .swiper-button-disabled{opacity:0.5;}
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .swiper-button-lock{display:none;}
    
  @media (max-width:768px) {
  .rr-widget-banner[data-s="{{data-retailrocket-markup-block}}"] .rr-item__image{width:100%;outline:none;height:auto}
  }
</style>
  
<div
    class="rr-widget-banner rr-widget-{{data-retailrocket-markup-block}}" 
    data-algorithm="popular"
    data-algorithm-argument="0"
    data-algorithm-param-stock-id="{{data-stock-id}}"
    data-template-param-header-text=""
    data-template-param-number-of-items="50"
    data-template-param-item-image-width="320"
    data-template-param-item-image-height="320"
    data-on-pre-render="retailrocket.store{{data-retailrocket-markup-block}}.preRenderFn(this, data, renderFn)"
    data-on-post-render="retailrocket.store{{data-retailrocket-markup-block}}.postRenderFn(this)"
    data-template-container-id="widget-template-{{data-retailrocket-markup-block}}"
    data-textoverflowhidden="true"
    data-s="{{data-retailrocket-markup-block}}">
</div>

<script id="widget-template-{{data-retailrocket-markup-block}}" type="text/html">
  <div class="retailrocket-items rr-swiper-container">
    <div class="rr-swiper-wrapper">
      <% for (var i = 0 ; i < numberOfItems; ++i) with(items[i]) { %>
        <div class="rr-swiper-slide" data-id="<%= bannerId %>">
          <div class="retailrocket-item">
            <div class="rr-item__img-block">
              <a class="rr-item__info" href="<%= bannerHref %>" onmousedown='rrApi.recomMouseDown(<%= bannerId %>, { suggester: "<%=suggesterId%>", methodName: "<%=algorithm%>" });'>
                <img class="rr-item__image" src="<%= bannerUrl %>">
              </a>
            </div>
          </div>
        </div>
      <% } %>
    </div>
  </div>
  <div class="rr-slider-arrow">
    <a class="rr-arrow swiper-prev"></a>
    <a class="rr-arrow swiper-next"></a>
  </div>
</script>

<script type="text/javascript">
  (function (retailrocket) {
    'use strict';

    var SwiperModel = function (setting) {
      var $widget = setting.widget;
      var swiperSeector = '.rr-swiper-container';
      var source = 'https://rrstatic.retailrocket.net/widget/plugins/rrswiper/rrswiper.min.js';
      var itemsCount = $widget.getAttribute('data-number-of-rendered-items');

      function checkloop(paramsSlider) {
        var modSetting = paramsSlider;

        if (modSetting.loop == true) {
          for (var point in modSetting.breakpoints) {
            if (itemsCount <= modSetting.breakpoints[point].slidesPerView) {
              modSetting.breakpoints[point].loop = false;
            } else {
              modSetting.breakpoints[point].loop = true;
            }
          }
        }

        return modSetting;
      }

      function render(swiperLibrary) {
        var SwiperParams = checkloop(setting.settingSwiper);
        var $rrContainer = $widget.querySelector(swiperSeector);
        var rrSwiper = swiperLibrary == 'RRSwiper' ? new RRSwiper($rrContainer, SwiperParams) : new Swiper($rrContainer, SwiperParams);

        rrSwiper
          .on('init', function () {
          var $imgError = $widget.querySelectorAll('.rr-swiper-slide:not(.swiper-slide-duplicate) img');
          var counter = 0;
          var indexImg = [];

          $imgError.forEach(function (img) {
            img.onerror = function () {
              var $slideItem = img.closest('.rr-swiper-slide');
              var $slideSiblings = $slideItem.parentNode.querySelectorAll('.rr-swiper-slide:not(.swiper-slide-duplicate)');
              indexImg.push($slideItem.getAttribute('data-swiper-slide-index'));

              if ($imgError.length == counter) {
                rrSwiper.removeSlide(indexImg);
              }
            };
            counter++;
          });
          $widget.classList.add('rr-active');
        })
          .on('observerUpdate', function () {
          rrSwiper.resize.resizeHandler();
        });
        rrSwiper.init();
      }

      function getScript() {
        var swiperJs = document.createElement('script');
        var getElemScript = document.getElementsByTagName('script')[0];
        swiperJs.async = 1;

        if (!window.Swiper && !window.RRSwiper) {
          swiperJs.onload = swiperJs.onreadystatechange = function(_, isAbort) {
            if (isAbort || !swiperJs.readyState || /loaded|complete/.test(swiperJs.readyState) ) {
              swiperJs.onload = swiperJs.onreadystatechange = null;
              swiperJs = undefined;

              if (!isAbort) setTimeout(render('RRSwiper'), 0);
            }
          };

          swiperJs.src = source;
          getElemScript.parentNode.insertBefore(swiperJs, getElemScript);
        } else {
          var versionSwiper = window.hasOwnProperty('RRSwiper') ? 'RRSwiper' : 'Swiper';
          render(versionSwiper);
        }
      }

      this.getScript = getScript;
    };

    retailrocket['store{{data-retailrocket-markup-block}}'] = (function() {
      var recomTrackSetting = {
        nameTrack: '',
        abSegment: '',
        check: false,
        listTrack: function()
        {
          return [this.nameTrack, this.nameTrack + 'Search'];
        },
      };
      var impressionContentId = null;

      function setStatisticsRender(recoms) {
        if (recomTrackSetting.check) {
          var itemsId = recoms.map(function(product) { return product.ItemId });

          recomTrackSetting.listTrack().forEach(function(track) {
            rrApiOnReady.push(function() {
              rrApi.recomTrack(
                '{{data-retailrocket-markup-block}}',
                0,
                [itemsId],
                {
                  eventType: 'blockRender',
                  abtest: recomTrackSetting.abSegment,
                  algorithm: track
                }
              );
            });
          });
        }
      }

      function setStatisticsShow(recomIds) {
        if (recomTrackSetting.check) {
          recomTrackSetting.listTrack().forEach(function(track) {
            rrApiOnReady.push(function() {
              rrApi.recomTrack(
                '{{data-retailrocket-markup-block}}',
                0,
                [recomIds],
                {
                  eventType: 'blockView',
                  abtest: recomTrackSetting.abSegment,
                  algorithm: track
                }
              );
            });
          });

          if (impressionContentId !== null) {
            rrApi.impressionContentViewed({
              impressionContentId: impressionContentId,
              onSuccessCallback: function() {}
            });
          }
        }
      }

      function setStatisticsClick(itemId) {
        if (recomTrackSetting.check) {
          recomTrackSetting.listTrack().forEach(function(track) {
            rrApiOnReady.push(function() {
              rrApi.recomTrack(
                '{{data-retailrocket-markup-block}}',
                0,
                [],
                {
                  eventType: 'blockClick',
                  clickedItem: itemId,
                  abtest: recomTrackSetting.abSegment,
                  algorithm: track
                }
              );
            });
          });

          if (impressionContentId !== null) {
            rrApi.impressionContentClicked({
              impressionContentId: impressionContentId,
              onSuccessCallback: function() {}
            });
          }
        }
      }

      function setSpecificStatisticsRender(items, algorithm) {
        var itemsId = getProductsId(items);

        setStatisticsRender(itemsId, algorithm);
      }

      function getProductsId(products) {
        return products.map(function(product) {
          return product.ItemId;
        });
      }

      function getParsedResponse(response) {
        var responseMatch = response.match(/{[^}]+}/).toString();
        var responseParsed = JSON.parse(responseMatch.replace(/([a-zA-Z]+):/g,'"$1":'));

        return responseParsed;
      }

      function preRenderFn(widget, recoms, renderFn) {
        retailrocket.impression.forAnyPlacements({
          partnerId: retailrocket.api.getPartnerId(),
          placementId: getCurrentPlacementId(),
          session: retailrocket.api.getSessionId(),
          callbackContents: {
            'banners': function (content) {
              var spInfoStr = content.banners;
              impressionContentId = content.id;

              recomTrackSetting.check = true;
              recomTrackSetting.nameTrack = 'SP';

              setStatisticsRender(spInfoStr);
              setStatisticsShow();

              renderFn(spInfoStr);
            },
            'empty': function () {}
          },
        });
      }
      
      function postRenderFn(widget) {
        var products = widget.querySelectorAll('.rr-swiper-slide'),
            spProducts = widget.querySelectorAll('.rr-item__is-sp'),
            itemsId = [],
            isShow = false;
        
        var rrSwiperCarousel = new SwiperModel({
          widget: widget,
          settingSwiper: {
            wrapperClass: 'rr-swiper-wrapper',
            slideClass: 'rr-swiper-slide',
            init: false,
            updateOnWindowResize: true,
            watchOverflow: true,
            observer: true,
            spaceBetween: 0,
            lazy: {
              loadPrevNext: true,
            },
            preloadImages: true,
            touchReleaseOnEdges: true,
            watchSlidesVisibility: true,
            loop: true,
            navigation: {
              prevEl: widget.querySelector('.swiper-prev'),
              nextEl: widget.querySelector('.swiper-next'),
            },
            autoplay: false,
            speed: 800,
            breakpoints: {
              320: {
                slidesPerView: 1,
                slidesPerGroup: 1
              }
            }
          }
        });
        rrSwiperCarousel.getScript();
        
        products.forEach(function(item) { itemsId.push(item.getAttribute('data-id')) });
        spProducts.forEach(function(item) {
          item.addEventListener('click', function() {
            setStatisticsClick(item.getAttribute('data-id'));
          })
        })

        if (widget.getBoundingClientRect()['top'] < window.innerHeight) {
          setStatisticsShow(itemsId);
          isShow = true;
        } else {
          window.addEventListener('scroll', function() {
            if (!isShow) {
              var widgetScrollTop = widget.getBoundingClientRect()['top'];
              if (widgetScrollTop < window.innerHeight) {
                setStatisticsShow(itemsId);
                isShow = true;
              }
            }
          });
        }
      }

      return {
        preRenderFn: preRenderFn,
        postRenderFn: postRenderFn,
      };
    }()); 

    retailrocket.widget.render('rr-widget-{{data-retailrocket-markup-block}}');
    }(retailrocket));
</script>